---
import { getCollection } from 'astro:content';

const { pathname } = Astro.url;
const isHome = pathname === '/' || pathname === '/blog/2'; // Check if on home or archive pages

// Fetch posts for the 2x2 grid
const allPosts = await getCollection('blog', ({ data }) => data.draft !== true);

// Logic A: Trending (Latest 4)
const trendingPosts = [...allPosts].sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()).slice(0, 4);

// Logic B: You Might Like (Related by tags)
// Note: This assumes you pass 'currentTags' and 'currentSlug' as props from [...slug].astro
const { currentTags = [], currentSlug = "" } = Astro.props;
const relatedPosts = allPosts
  .filter(p => p.slug !== currentSlug && p.data.tags?.some(tag => currentTags.includes(tag)))
  .slice(0, 4);

// Choose which set to show
const displayPosts = isHome ? trendingPosts : relatedPosts;
const title = isHome ? "Trending News" : "You Might Like";
---

<aside class="sidebar-container">
    {displayPosts.length > 0 && (
        <section class="widget">
            <h3 class="widget-title">{title}</h3>
            <div class="grid-2x2">
                {displayPosts.map(post => (
                    <a href={`/posts/${post.slug}`} class="grid-item">
                        <div class="grid-thumb" style={`background-image: url(${post.data.image || post.data.heroImage})`}></div>
                        <div class="grid-info">
                            <span class="grid-cat">{post.data.category}</span>
                            <h4 class="grid-title">{post.data.title}</h4>
                        </div>
                    </a>
                ))}
            </div>
        </section>
    )}

    <div class="spacing"></div>

    <section class="widget">
        <h3 class="widget-title">Contact Form</h3>
        <form class="sidebar-form">
            <input type="text" placeholder="Name" required />
            <input type="email" placeholder="Email *" required />
            <textarea placeholder="Message *" required rows="3"></textarea>
            <button type="submit">Send Message</button>
        </form>
    </section>

    <div class="spacing"></div>

    <section class="notice-box shadow">
        <div class="notice-brand">THE MAIL <br> <span style="color: #002b5c;">NAGPUR</span></div>
        <div class="notice-header">A Humble Notice to Readers</div>
        <p class="notice-text">
            Readers are advised to verify the content of advertisements before making any financial transactions. 
            <strong>The Nagpur Mail</strong> is not responsible for external claims.
        </p>
    </section>
</aside>

<style>
    .spacing { height: 35px; } /* Your requested space between segments */
    .widget-title { border-bottom: 2px solid #002b5c; color: #002b5c; font-size: 16px; font-weight: 900; text-transform: uppercase; margin-bottom: 15px; padding-bottom: 5px; }
    
    .grid-2x2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    .grid-thumb { width: 100%; height: 75px; background-size: cover; background-position: center; border-radius: 4px; }
    .grid-cat { font-size: 9px; color: #4285f4; font-weight: 800; text-transform: uppercase; display: block; margin-top: 5px; }
    .grid-title { font-size: 11px; font-weight: 700; line-height: 1.2; margin-top: 2px; color: #333; }

    .sidebar-form { display: flex; flex-direction: column; gap: 8px; }
    .sidebar-form input, .sidebar-form textarea { padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 13px; }
    .sidebar-form button { background: #002b5c; color: white; border: none; padding: 12px; font-weight: bold; text-transform: uppercase; cursor: pointer; font-size: 11px; }

    .notice-box { padding: 15px; background: #f9f9f9; border-top: 3px solid #002b5c; text-align: center; }
    .notice-brand { font-weight: 900; font-size: 14px; color: #666; margin-bottom: 8px; }
    .notice-header { font-size: 11px; font-weight: bold; color: #d9534f; margin-bottom: 5px; text-transform: uppercase; }
    .notice-text { font-size: 10px; line-height: 1.4; color: #555; font-style: italic; }
</style>
