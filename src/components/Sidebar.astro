---
import { getCollection } from 'astro:content';

// Fetch all posts and take the top 4 for "Trending"
const trendingPosts = (await getCollection('blog', ({ data }) => {
  return data.draft !== true;
})).sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()).slice(0, 4);
---

<aside>
    <div class="widget">
        <h3 class="widget-title">Trending News</h3>
        <div class="trending-grid">
            {trendingPosts.map(post => (
                <a href={`/posts/${post.slug}`} class="trending-item">
                    <div class="trending-thumb" style={`background-image: url(${post.data.image || post.data.heroImage})`}></div>
                    <div class="trending-info">
                        <span class="trending-cat">{post.data.category}</span>
                        <h4 class="trending-title">{post.data.title}</h4>
                    </div>
                </a>
            ))}
        </div>
    </div>

    <div class="widget">
        <h3 class="widget-title">Contact Form</h3>
        <form style="display: flex; flex-direction: column; gap: 10px;">
            <input type="text" placeholder="Name" style="padding: 10px; border: 1px solid #ddd; font-size: 13px; border-radius: 4px;">
            <input type="email" placeholder="Email *" required style="padding: 10px; border: 1px solid #ddd; font-size: 13px; border-radius: 4px;">
            <textarea placeholder="Message *" required rows="4" style="padding: 10px; border: 1px solid #ddd; font-size: 13px; border-radius: 4px;"></textarea>
            <button type="submit" style="background: #002b5c; color: white; border: none; padding: 12px; font-weight: bold; text-transform: uppercase; cursor: pointer; border-radius: 4px; font-size: 12px;">Send Message</button>
        </form>
    </div>

    <div class="notice-box shadow">
        <div style="text-align: center; font-weight: 900; font-size: 12px; color: #666; margin-bottom: 5px;">THE MAIL <br> <span style="color: #002b5c;">NAGPUR</span></div>
        <div class="notice-header">A Humble Notice to Readers</div>
        <p style="font-size: 11px; font-style: italic; line-height: 1.4; color: #444;">
            Readers are advised to verify the content before making any financial transactions. Nagpur Mail is not responsible for the claims made in external notices.
        </p>
    </div>
</aside>

<style>
    .trending-grid {
        display: grid;
        grid-template-columns: 1fr 1fr; /* 2 Column Grid for Desktop/Mobile */
        gap: 10px;
        margin-top: 15px;
    }
    .trending-item { text-decoration: none; color: inherit; display: block; }
    .trending-thumb {
        width: 100%;
        height: 80px;
        background-size: cover;
        background-position: center;
        border-radius: 4px;
    }
    .trending-cat { font-size: 9px; color: #4285f4; font-weight: 900; text-transform: uppercase; margin-top: 5px; display: block; }
    .trending-title {
        font-size: 11px;
        line-height: 1.2;
        margin-top: 3px;
        font-weight: 700;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
    }
    
    /* List View for Sidebar when not in grid mode (Optional) */
    @media (min-width: 1024px) {
        .trending-grid { grid-template-columns: 1fr; }
        .trending-item { display: flex; gap: 10px; align-items: center; border-bottom: 1px solid #eee; padding-bottom: 8px; }
        .trending-thumb { width: 60px; height: 60px; flex-shrink: 0; }
    }
</style>
